---
import Layout from '../../layouts/Layout.astro';
import ContactSection from '../../components/sections/ContactSection.astro';
import SuccessStoriesPage from '../../components/pages/SuccessStoriesPage.astro';
import { defaultLocale, getMessages, locales, type Locale } from '../../i18n/config';
import { getAlternateLinks, buildLocaleUrl } from '../../i18n/utils';
import { successStoriesPageCopy } from '../../data/pages';

const locale: Locale = defaultLocale;
const messages = getMessages(locale);
const pageCopy = successStoriesPageCopy[locale];
const alternateLinks = getAlternateLinks(locale, Astro.url);

const languageSwitcher = {
  current: locale,
  options: locales.map((lang) => ({
    label: lang.toUpperCase(),
    value: lang,
    href: buildLocaleUrl(lang, Astro.url),
  })),
};

const collectionStructuredData = {
  '@context': 'https://schema.org',
  '@type': 'CollectionPage',
  name: pageCopy.meta.title,
  description: pageCopy.meta.description,
  hasPart: messages.successStories.recentProjects.items.map((item) => ({
    '@type': 'CreativeWork',
    name: item.description,
    datePublished: item.year,
  })),
};
---

<Layout
  locale={locale}
  messages={messages}
  alternateLinks={alternateLinks}
  languageSwitcher={languageSwitcher}
  pageMeta={pageCopy.meta}
  additionalStructuredData={[collectionStructuredData]}
>
  <SuccessStoriesPage
    successStories={messages.successStories}
    contact={messages.contact}
    footerContact={messages.footer.contact}
    copy={pageCopy}
    contactHref="#contact"
  />
  <ContactSection contact={messages.contact} phoneNumber={messages.footer.contact.phone} />
</Layout>
