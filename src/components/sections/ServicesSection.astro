---
import Section from '../ui/Section.astro';
import Container from '../ui/Container.astro';
import SectionHeading from '../ui/SectionHeading.astro';
import Button from '../ui/Button.astro';

interface Props {
  services: {
    eyebrow: string;
    heading: string;
    intro: string;
    categories: {
      id: string;
      title: string;
      description: string;
      items: string[];
      image: { src: string; alt: string };
    }[];
  };
  ctaLabel: string;
}

const MOBILE_VISIBLE_COUNT = 4;
const { services, ctaLabel } = Astro.props satisfies Props;
---

<Section id="services">
  <Container>
    <SectionHeading
      align="center"
      eyebrow={services.eyebrow}
      title={services.heading}
      description={services.intro}
    />
    <div class="mt-16 space-y-16">
      {services.categories.map((category, index) => {
        const isEven = index % 2 === 0;

        const extraItems = category.items.slice(MOBILE_VISIBLE_COUNT);
        const hasExtraItems = extraItems.length > 0;
        return (
          <article
            id={category.id}
            class="rounded-[36px] border border-white/10 bg-white/5 p-6 shadow-[0_45px_140px_-60px_rgba(10,132,255,0.45)] backdrop-blur-xl transition hover:border-white/20"
          >
            <div class="grid gap-10 lg:grid-cols-[repeat(2,minmax(0,1fr))] lg:items-center">
              <figure
                class={`group relative overflow-hidden rounded-[28px] bg-[#001f3f]/60 ${
                  isEven ? '' : 'lg:order-2'
                }`}
              >
                <img
                  src={category.image.src}
                  alt={category.image.alt}
                  loading="lazy"
                  decoding="async"
                  class="h-full w-full object-cover transition duration-500 group-hover:scale-105"
                />
                <div class="pointer-events-none absolute inset-0 bg-gradient-to-t from-[#001f3f]/15 via-transparent to-transparent"></div>
              </figure>
              <div class={`flex flex-col gap-6 lg:gap-7 ${isEven ? '' : 'lg:order-1'}`}>
                <div class="space-y-3 lg:space-y-4">
                  <span class="text-sm font-semibold uppercase tracking-[0.2em] text-coral-200/90">
                    {services.eyebrow}
                  </span>
                  <h3 class="font-display text-3xl font-semibold text-white lg:text-4xl">
                    {category.title}
                  </h3>
                  <p class="text-base text-white/90 lg:text-lg">{category.description}</p>
                </div>
                <ul class="grid gap-3 text-sm text-white/90 sm:grid-cols-2">
                  {category.items.map((item, index) => (
                    <li
                      class={`flex items-start gap-2 rounded-2xl bg-white/5 p-3 shadow-[0_20px_70px_-50px_rgba(10,132,255,0.8)] ${
                        index >= MOBILE_VISIBLE_COUNT ? 'hidden sm:flex' : ''
                      }`}
                    >
                      <span aria-hidden="true" class="mt-1 inline-block h-2.5 w-2.5 rounded-full bg-coral-200"></span>
                      <span class="text-white">{item}</span>
                    </li>
                  ))}
                </ul>
                {hasExtraItems && (
                  <details class="group sm:hidden">
                    <summary class="mt-4 flex cursor-pointer items-center justify-center gap-2 rounded-full border border-white/20 bg-white/5 px-4 py-2 text-sm font-semibold text-white shadow-[0_10px_40px_-25px_rgba(10,132,255,0.8)] transition hover:border-white/40 hover:bg-white/10 open:hidden">
                      Show more
                      <svg
                        class="h-4 w-4"
                        viewBox="0 0 24 24"
                        fill="none"
                        xmlns="http://www.w3.org/2000/svg"
                        aria-hidden="true"
                      >
                        <path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" />
                      </svg>
                    </summary>
                    <ul class="mt-4 grid gap-3 text-sm text-white/90">
                      {extraItems.map((item) => (
                        <li class="flex items-start gap-2 rounded-2xl bg-white/5 p-3 shadow-[0_20px_70px_-50px_rgba(10,132,255,0.8)]">
                          <span aria-hidden="true" class="mt-1 inline-block h-2.5 w-2.5 rounded-full bg-coral-200"></span>
                          <span class="text-white">{item}</span>
                        </li>
                      ))}
                    </ul>
                  </details>
                )}
                <div class="pt-2">
                  <Button variant="primary" size="lg" href="#contact" class="w-full justify-center lg:w-auto">
                    {ctaLabel}
                  </Button>
                </div>
              </div>
            </div>
          </article>
        );
      })}
    </div>
  </Container>
</Section>
