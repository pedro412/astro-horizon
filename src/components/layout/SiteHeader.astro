---
import Button from "../ui/Button.astro";
import Container from "../ui/Container.astro";
import { defaultLocale, type Locale } from "../../i18n/config";
import logo from "../../assets/bluehorizon-logo.png";

interface Props {
  nav: { label: string; href: string }[];
  locale: Locale;
  languageSwitcher: {
    current: Locale;
    options: { label: string; value: Locale; href: string }[];
  };
  contactCta: string;
}

const { nav, locale, languageSwitcher, contactCta } =
  Astro.props satisfies Props;
const homeHref = locale === defaultLocale ? "/" : `/${locale}`;
const resolveHref = (href: string) => {
  if (href.startsWith("#") || href.startsWith("http")) {
    return href;
  }
  if (href.startsWith("/")) {
    if (locale === defaultLocale) {
      return href;
    }
    if (href === "/") {
      return `/${locale}`;
    }
    return `/${locale}${href}`;
  }
  return href;
};
const resolvedNav = nav.map((item) => ({
  ...item,
  href: resolveHref(item.href),
}));
---

<header
  class="fixed inset-x-0 top-0 z-50 border-b border-white/10 bg-[rgba(5,9,20,0.72)] shadow-[0_20px_60px_-40px_rgba(10,132,255,0.6)] backdrop-blur-2xl"
>
  <Container class="flex h-20 items-center gap-6">
    <a
      href={homeHref}
      class="flex items-center gap-3 text-white transition hover:opacity-90"
    >
      <div
        class="flex h-10 w-10 items-center justify-center rounded-full bg-white/5"
      >
        <img
          src={logo.src}
          alt="Blue Horizon logo"
          class="h-full w-full object-contain"
          loading="lazy"
          decoding="async"
        />
      </div>
      <div class="leading-tight">
        <p class="font-display text-lg font-semibold text-white">
          Blue Horizon
        </p>
      </div>
    </a>
    <nav
      class="hidden flex-1 items-center justify-center gap-6 text-sm font-medium text-white md:flex"
    >
      {
        resolvedNav.map((item) => (
          <a
            class="rounded-full px-3 py-2 text-white transition-colors hover:bg-white/10 hover:text-white"
            href={item.href}
          >
            {item.label}
          </a>
        ))
      }
    </nav>
    <div class="ml-auto hidden items-center gap-3 md:flex">
      <div
        class="flex items-center gap-1 rounded-full border border-white/15 bg-white/10 px-2 py-1 text-xs font-medium text-white shadow-[0_15px_50px_-30px_rgba(10,132,255,0.55)] backdrop-blur-xl"
      >
        {
          languageSwitcher.options.map((option) => (
            <a
              class={`rounded-full px-2.5 py-1 transition ${
                option.value === languageSwitcher.current
                  ? "bg-white/20 text-white shadow-inner shadow-white/20"
                  : "text-white hover:bg-white/10 hover:text-white"
              }`}
              href={option.href}
            >
              {option.label}
            </a>
          ))
        }
      </div>
      <Button variant="primary" size="md" href="#contact">
        {contactCta}
      </Button>
    </div>
    <details class="relative ml-auto flex md:hidden">
      <summary
        class="flex list-none cursor-pointer items-center gap-2 rounded-full border border-white/15 bg-white/10 p-2 text-xs font-semibold text-white shadow-[0_15px_50px_-30px_rgba(10,132,255,0.55)] backdrop-blur-xl"
      >
        <span class="sr-only">Menu</span>
        <svg
          class="h-5 w-5 text-white"
          viewBox="0 0 24 24"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
          aria-hidden="true"
        >
          <path
            d="M4 7h16M4 12h16M4 17h16"
            stroke="currentColor"
            stroke-width="1.8"
            stroke-linecap="round"
            stroke-linejoin="round"></path>
        </svg>
      </summary>
      <div
        class="absolute right-0 top-14 z-50 min-w-[240px] space-y-4 rounded-[26px] border border-white/20 bg-[rgba(10,18,41,0.72)] p-5 text-white shadow-[0_35px_120px_-45px_rgba(10,132,255,0.65)] backdrop-blur-3xl [&_a:link]:text-white [&_a:visited]:text-white [&_a:hover]:text-white [&_a:focus]:text-white [&_a:focus-visible]:text-white"
      >
        <nav class="space-y-2 text-sm font-medium text-white">
          {
            resolvedNav.map((item) => (
              <a
                class="block rounded-xl px-3 py-2 text-white transition hover:bg-white/10 hover:text-white focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-white/60 visited:text-white"
                href={item.href}
              >
                {item.label}
              </a>
            ))
          }
        </nav>
        <div
          class="flex items-center justify-between rounded-xl border border-white/15 bg-white/5 p-2 text-white"
        >
          {
            languageSwitcher.options.map((option) => (
              <a
                class={`flex-1 rounded-lg px-3 py-2 text-center text-xs font-medium ${
                  option.value === languageSwitcher.current
                    ? "bg-white/20 text-white shadow-inner shadow-white/20"
                    : "text-white hover:bg-white/10 hover:text-white"
                }`}
                href={option.href}
              >
                {option.label}
              </a>
            ))
          }
        </div>
        <Button
          variant="primary"
          size="lg"
          href="#contact"
          class="w-full justify-center"
        >
          {contactCta}
        </Button>
      </div>
    </details>
  </Container>
</header>
